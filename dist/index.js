"use strict";var n=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var f=n(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.GithubActionsExecError=void 0;var Ye=require("../node_modules/effect/dist/cjs/Data.js"),Z=class extends(0,Ye.TaggedError)("github-actions-exec"){};p.GithubActionsExecError=Z});var ve=n(m=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.push=void 0;var Ze=require("../node_modules/@actions/exec/lib/exec.js"),ee=require("../node_modules/effect/dist/cjs/index.js"),et=f();m.push=(0,ee.pipe)(ee.Effect.tryPromise({try:()=>(0,Ze.exec)("git push"),catch:e=>new et.GithubActionsExecError({message:e.message})}),ee.Effect.withSpan("push"))});var ye=n(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.pushTags=void 0;var tt=require("../node_modules/@actions/exec/lib/exec.js"),te=require("../node_modules/effect/dist/cjs/index.js"),rt=f();b.pushTags=(0,te.pipe)(te.Effect.tryPromise({try:()=>(0,tt.exec)("git push",["--tags"]),catch:e=>new rt.GithubActionsExecError({message:e.message})}),te.Effect.withSpan("push-tags"))});var qe=n(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.setGitUserEmail=void 0;var nt=require("../node_modules/@actions/exec/lib/exec.js"),re=require("../node_modules/effect/dist/cjs/index.js"),it=f(),ot=e=>(0,re.pipe)(re.Effect.tryPromise({try:()=>(0,nt.exec)("git config",["--global","user.email",e]),catch:t=>new it.GithubActionsExecError({message:t.message})}),re.Effect.withSpan("set-git-user-email",{attributes:{email:e}}));E.setGitUserEmail=ot});var we=n(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.setGitUserName=void 0;var st=require("../node_modules/@actions/exec/lib/exec.js"),ne=require("../node_modules/effect/dist/cjs/index.js"),ct=f(),ut=e=>(0,ne.pipe)(ne.Effect.tryPromise({try:()=>(0,st.exec)("git config",["--global","user.name",e]),catch:t=>new ct.GithubActionsExecError({message:t.message})}),ne.Effect.withSpan("set-git-user-name",{attributes:{userName:e}}));v.setGitUserName=ut});var Me=n(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.setVersion=void 0;var at=require("../node_modules/@actions/exec/lib/exec.js"),ie=require("../node_modules/effect/dist/cjs/index.js"),ft=f(),dt=e=>(0,ie.pipe)(ie.Effect.tryPromise({try:()=>(0,at.exec)("npm version",[e,"--force"]),catch:t=>new ft.GithubActionsExecError({message:t.message})}),ie.Effect.withSpan("set-version",{attributes:{bumpType:e}}));y.setVersion=dt});var oe=n(s=>{"use strict";var lt=s&&s.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),l=s&&s.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&lt(t,e,r)};Object.defineProperty(s,"__esModule",{value:!0});l(ve(),s);l(ye(),s);l(qe(),s);l(we(),s);l(Me(),s)});var Oe=n(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.getUserEmail=void 0;var _t=require("../node_modules/@actions/core/lib/core.js"),gt=require("../node_modules/@actions/github/lib/github.js"),se=require("../node_modules/effect/dist/cjs/index.js");q.getUserEmail=(0,se.pipe)(se.Effect.sync(()=>{let e=(0,_t.getInput)("commit-user-email");return e.length===0?`${gt.context.actor}@users.noreply.github.com`:e}),se.Effect.withSpan("get-user-email"))});var Pe=n(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.getUserName=void 0;var ht=require("../node_modules/@actions/core/lib/core.js"),pt=require("../node_modules/@actions/github/lib/github.js"),ce=require("../node_modules/effect/dist/cjs/index.js");w.getUserName=(0,ce.pipe)(ce.Effect.sync(()=>{let e=(0,ht.getInput)("commit-user");return e.length===0?pt.context.actor:e}),ce.Effect.withSpan("get-user-name"))});var xe=n(u=>{"use strict";var mt=u&&u.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),je=u&&u.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&mt(t,e,r)};Object.defineProperty(u,"__esModule",{value:!0});je(Oe(),u);je(Pe(),u)});var Ge=n(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.setGitConfig=void 0;var _=require("../node_modules/effect/dist/cjs/index.js"),Be=oe(),De=xe();M.setGitConfig=(0,_.pipe)(_.Effect.all([De.getUserEmail,De.getUserName],{concurrency:"unbounded"}),_.Effect.flatMap(([e,t])=>_.Effect.all([(0,Be.setGitUserEmail)(e),(0,Be.setGitUserName)(t)],{concurrency:"unbounded"})),_.Effect.withSpan("set-git-config"))});var Se=n(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.CommitMessagesExtractionError=void 0;var bt=require("../node_modules/effect/dist/cjs/Data.js"),ue=class extends(0,bt.TaggedError)("commit-messages-extraction"){};O.CommitMessagesExtractionError=ue});var Ne=n(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.extractCommitsMessages=void 0;var P=require("../node_modules/effect/dist/cjs/index.js"),Et=Se(),Ie=e=>e.substring(e.indexOf("*")).split(`\r
\r
`).map(t=>t.substring(t.indexOf("* ")+2)),vt=e=>(0,P.pipe)(P.Effect.gen(function*(){var t,r;return Array.isArray(e.commits)&&e.commits.length===1&&e.commits[0].committer.name==="GitHub"&&e.commits[0].distinct===!0?Ie(e.commits[0].message):e.action==="completed"&&((r=(t=e.workflow_run)===null||t===void 0?void 0:t.head_commit)===null||r===void 0?void 0:r.message)!==void 0?Ie(e.workflow_run.head_commit.message):Array.isArray(e.commits)?e.commits.map(d=>d.message):yield*P.Effect.fail(new Et.CommitMessagesExtractionError({cause:"Failed to extract commit message"}))}),P.Effect.withSpan("extract-commits-messages",{attributes:{event:e}}));j.extractCommitsMessages=vt});var Ce=n(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.UnknownDefaultBranchError=void 0;var yt=require("../node_modules/effect/dist/cjs/Data.js"),ae=class extends(0,yt.TaggedError)("unknown-default-branch"){};x.UnknownDefaultBranchError=ae});var Te=n(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.failIfNoDefaultBranch=void 0;var B=require("../node_modules/effect/dist/cjs/index.js"),qt=Ce(),wt=e=>(0,B.pipe)(B.Effect.gen(function*(){var t;let r=(t=e?.repository)===null||t===void 0?void 0:t.default_branch;(!r||r.length===0)&&(yield*B.Effect.fail(new qt.UnknownDefaultBranchError({cause:"Failed to locate default branch"})))}),B.Effect.withSpan("fail-if-no-default-branch",{attributes:{event:e}}));D.failIfNoDefaultBranch=wt});var Ue=n(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.NotRunningOnDefaultBranchError=void 0;var Mt=require("../node_modules/effect/dist/cjs/Data.js"),fe=class extends(0,Mt.TaggedError)("not-running-on-default-branch"){};G.NotRunningOnDefaultBranchError=fe});var Fe=n(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.UnknownCurrentBranchError=void 0;var Ot=require("../node_modules/effect/dist/cjs/Data.js"),de=class extends(0,Ot.TaggedError)("unknown-current-branch"){};S.UnknownCurrentBranchError=de});var ke=n(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.getCurrentBranch=void 0;var I=require("../node_modules/effect/dist/cjs/index.js"),Pt=Fe(),jt=e=>(0,I.pipe)(I.Effect.gen(function*(){var t,r;return e?.ref!==void 0?(t=e.ref)===null||t===void 0?void 0:t.split("/").slice(2).join("/"):e.action==="completed"&&((r=e?.workflow_run)===null||r===void 0?void 0:r.head_branch)!==void 0?e.workflow_run.head_branch:yield*I.Effect.fail(new Pt.UnknownCurrentBranchError({cause:"Failed to locate current branch"}))}),I.Effect.withSpan("get-current-branch",{attributes:{event:e}}));N.getCurrentBranch=jt});var Ae=n(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.failIfNotRunningOnCurrentBranch=void 0;var C=require("../node_modules/effect/dist/cjs/index.js"),xt=Ue(),Bt=ke(),Dt=e=>(0,C.pipe)(C.Effect.gen(function*(){var t;let r=yield*(0,Bt.getCurrentBranch)(e),i=(t=e?.repository)===null||t===void 0?void 0:t.default_branch;r===i||(yield*C.Effect.fail(new xt.NotRunningOnDefaultBranchError({cause:"Not running on current branch"})))}),C.Effect.withSpan("fail-if-not-running-on-current-branch",{attributes:{event:e}}));T.failIfNotRunningOnCurrentBranch=Dt});var Re=n(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.maybeDebugEvent=void 0;var le=require("../node_modules/@actions/core/lib/core.js"),_e=require("../node_modules/effect/dist/cjs/index.js"),Gt=e=>(0,_e.pipe)(_e.Effect.try(()=>{(0,le.getInput)("debug")==="true"&&((0,le.info)("\u{1F575}\uFE0F Github event:"),(0,le.info)(JSON.stringify(e,null,2)))}),_e.Effect.withSpan("maybe-debug-event",{attributes:{event:e}}));U.maybeDebugEvent=Gt});var Ke=n(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.NoGithubEventError=void 0;var St=require("../node_modules/effect/dist/cjs/Data.js"),ge=class extends(0,St.TaggedError)("no-github-event"){};F.NoGithubEventError=ge});var Ve=n(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.readGithubEvent=void 0;var It=require("node:fs"),g=require("../node_modules/effect/dist/cjs/index.js"),Nt=Ke();k.readGithubEvent=(0,g.pipe)((0,g.pipe)(g.Effect.try(()=>JSON.parse((0,It.readFileSync)(process.env.GITHUB_EVENT_PATH,{encoding:"utf8"}))),g.Effect.catchAll(e=>new Nt.NoGithubEventError({message:e.message})),g.Effect.withSpan("read-github-event")))});var We=n(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.getGithubEventData=void 0;var h=require("../node_modules/effect/dist/cjs/index.js"),Ct=Ne(),Tt=Te(),Ut=Ae(),Ft=Re(),kt=Ve();A.getGithubEventData=(0,h.pipe)(kt.readGithubEvent,h.Effect.flatMap(e=>h.Effect.all([(0,Ft.maybeDebugEvent)(e),(0,Tt.failIfNoDefaultBranch)(e),(0,Ut.failIfNotRunningOnCurrentBranch)(e),(0,Ct.extractCommitsMessages)(e)])),h.Effect.map(([,,,e])=>e),h.Effect.withSpan("get-github-event-data"))});var He=n(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});R.getErrorMessageFrom=void 0;var a=require("../node_modules/effect/dist/cjs/index.js"),At=e=>a.Match.value(e).pipe(a.Match.when({_tag:"no-github-event"},()=>"\u274C Failed to get github event data."),a.Match.when({_tag:"unknown-current-branch"},()=>"\u274C Failed to get current branch from github event."),a.Match.when({_tag:"unknown-default-branch"},()=>"\u274C Failed to get default branch from github event."),a.Match.when({_tag:"commit-messages-extraction"},()=>"\u274C Failed to extract commit messages from github event."),a.Match.when({_tag:"invalid-keywords"},()=>"\u274C Invalid keywords provided."),a.Match.orElse(()=>"\u274C Oh no! An unknown error occured."));R.getErrorMessageFrom=At});var $e=n(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.getInfoMessageFrom=void 0;var K=require("../node_modules/effect/dist/cjs/index.js"),Rt=e=>K.Match.value(e).pipe(K.Match.when({_tag:"not-running-on-default-branch"},()=>"\u2139\uFE0F Task cancelled: not running on default branch."),K.Match.when({_tag:"no-version-bump-requested"},()=>"\u2139\uFE0F Task cancelled: no version bump requested."),K.Match.exhaustive);V.getInfoMessageFrom=Rt});var Je=n(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.NoVersionBumpRequestedError=void 0;var Kt=require("../node_modules/effect/dist/cjs/Data.js"),he=class extends(0,Kt.TaggedError)("no-version-bump-requested"){};W.NoVersionBumpRequestedError=he});var ze=n($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.getBumpType=void 0;var H=require("../node_modules/effect/dist/cjs/index.js"),Vt=Je(),pe=(e,t)=>t.some(r=>e.some(i=>r.startsWith(i))),Wt=([e,t])=>(0,H.pipe)(H.Effect.gen(function*(){return pe(t.major,e)?"major":pe(t.minor,e)?"minor":t.shouldDefaultToPatch||pe(t.patch,e)?"patch":yield*H.Effect.fail(new Vt.NoVersionBumpRequestedError({cause:"No version bump requested"}))}),H.Effect.withSpan("get-bump-type",{attributes:{messages:e,keywords:t}}));$.getBumpType=Wt});var Le=n(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.InvalidKeywordsError=void 0;var Ht=require("../node_modules/effect/dist/cjs/Data.js"),me=class extends(0,Ht.TaggedError)("invalid-keywords"){};J.InvalidKeywordsError=me});var Qe=n(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.getKeywords=void 0;var be=require("../node_modules/@actions/core/lib/core.js"),z=require("../node_modules/effect/dist/cjs/index.js"),$t=Le(),L=e=>e.length===1&&e[0].length===0;Q.getKeywords=(0,z.pipe)(z.Effect.gen(function*(){let e=(0,be.getInput)("should-default-to-patch")==="true",t=["major","minor","patch"].map((i,o)=>{let d=(0,be.getInput)(`${i}-keywords`).split(",");return(o===2&&!e&&L(d)||o!==2&&L(d))&&(0,be.error)(`\u26A0\uFE0F Expecting at least one ${i} keyword but got 0.`),d});return(e?t.slice(0,-1).some(i=>L(i)):t.some(i=>L(i)))?yield*z.Effect.fail(new $t.InvalidKeywordsError({cause:"Invalid keywords"})):{shouldDefaultToPatch:e,major:t[0],minor:t[1],patch:t[2]}}),z.Effect.withSpan("get-keywords"))});var Xe=n(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.actionWorkflow=void 0;var X=require("../node_modules/@actions/core/lib/core.js"),c=require("../node_modules/effect/dist/cjs/index.js"),Jt=Ge(),Ee=oe(),zt=We(),Lt=He(),Qt=$e(),Xt=ze(),Yt=Qe();Y.actionWorkflow=(0,c.pipe)(c.Effect.all([zt.getGithubEventData,Yt.getKeywords]),c.Effect.flatMap(Xt.getBumpType),c.Effect.flatMap(e=>c.Effect.all([Jt.setGitConfig,(0,Ee.setVersion)(e),Ee.push,Ee.pushTags])),c.Effect.tap(()=>(0,X.setOutput)("bump-performed",!0)),c.Effect.catchAll(e=>((0,X.setOutput)("bump-performed",!1),e._tag==="not-running-on-default-branch"||e._tag==="no-version-bump-requested"?((0,X.info)((0,Qt.getInfoMessageFrom)(e)),c.Effect.void):((0,X.setFailed)((0,Lt.getErrorMessageFrom)(e)),c.Effect.fail(e)))),c.Effect.withSpan("action-workflow"))});Object.defineProperty(exports,"__esModule",{value:!0});var Zt=require("../node_modules/effect-errors/cjs/index.js"),er=Xe();(0,Zt.runPromise)(er.actionWorkflow);
